var t,e=(t=require("crypto"))&&"object"==typeof t&&"default"in t?t.default:t;!function(t,e){t(e={exports:{}},e.exports)}(function(t){!function(n){var r,i,o,s,c;n?function(){var t=n.crypto||n.msCrypto;if(!r&&t&&t.getRandomValues)try{var e=new Uint8Array(16);s=r=function(){return t.getRandomValues(e),e},r()}catch(t){}if(!r){var o=new Array(16);i=r=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}():function(){try{var t=e.randomBytes;o=r=t&&function(){return t(16)},r()}catch(t){}}();for(var a="function"==typeof Buffer?Buffer:Array,u=[],d={},l=0;l<256;l++)u[l]=(l+256).toString(16).substr(1),d[u[l]]=l;function g(t,e){var n=e||0;return u[t[n++]]+u[t[n++]]+u[t[n++]]+u[t[n++]]+"-"+u[t[n++]]+u[t[n++]]+"-"+u[t[n++]]+u[t[n++]]+"-"+u[t[n++]]+u[t[n++]]+"-"+u[t[n++]]+u[t[n++]]+u[t[n++]]+u[t[n++]]+u[t[n++]]+u[t[n++]]}var h=r(),p=[1|h[0],h[1],h[2],h[3],h[4],h[5]],f=16383&(h[6]<<8|h[7]),m=0,w=0;function v(t,e,n){var i=e&&n||0;"string"==typeof t&&(e="binary"===t?new a(16):null,t=null);var o=(t=t||{}).random||(t.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var s=0;s<16;s++)e[i+s]=o[s];return e||g(o)}var I=v;I.v1=function(t,e,n){var r=e&&n||0,i=e||[],o=null!=(t=t||{}).clockseq?t.clockseq:f,s=null!=t.msecs?t.msecs:(new Date).getTime(),c=null!=t.nsecs?t.nsecs:w+1,a=s-m+(c-w)/1e4;if(a<0&&null==t.clockseq&&(o=o+1&16383),(a<0||s>m)&&null==t.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=s,w=c,f=o;var u=(1e4*(268435455&(s+=122192928e5))+c)%4294967296;i[r++]=u>>>24&255,i[r++]=u>>>16&255,i[r++]=u>>>8&255,i[r++]=255&u;var d=s/4294967296*1e4&268435455;i[r++]=d>>>8&255,i[r++]=255&d,i[r++]=d>>>24&15|16,i[r++]=d>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var l=t.node||p,h=0;h<6;h++)i[r+h]=l[h];return e||g(i)},I.v4=v,I.parse=function(t,e,n){var r=e&&n||0,i=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){i<16&&(e[r+i++]=d[t])});i<16;)e[r+i++]=0;return e},I.unparse=g,I.BufferClass=a,I._rng=r,I._mathRNG=i,I._nodeRNG=o,I._whatwgRNG=s,t.exports?t.exports=I:(c=n.uuid,I.noConflict=function(){return n.uuid=c,I},n.uuid=I)}("undefined"!=typeof window?window:null)});var n={};function r(t,e){return e.encode?e.strict?encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):encodeURIComponent(t):t}n.stringify=function(t,e){if(!t)return"";!1===(e=Object.assign({},t,{encode:!0,strict:!0})).sort&&(e.sort=function(){});return Object.keys(t).sort(e.sort).map(function(n){var i=t[n];if(void 0===i)return"";if(null===i)return r(n,e);if(Array.isArray(i)){var o=[];return i.slice().forEach(function(t){void 0!==t&&o.push(function(t,n){return null===n?r(t,e):[r(t,e),"=",r(n,e)].join("")}(n,t))}),o.join("&")}return r(n,e)+"="+r(i,e)}).filter(function(t){return t.length>0}).join("&")};var i=function(){var t=function(t){if(void 0===t&&(t=""),!t)throw new Error("`tagId` argument required for `Reporter` (e.g., `XXXXXX-YY`)");this.tagId=t};return t.setTagId=function(t){void 0===t&&(t=null),this.tagId=t},t.saveConsent=function(e){return void 0===e&&(e=!0),!!t.consented()&&(localStorage.setItem("xrAgent.metrics.settings.consent",e?"true":"false"),!0)},t.removeConsent=function(e){return void 0===e&&(e=!0),!!t.consented()&&(localStorage.removeItem("xrAgent.metrics.clientId"),localStorage.removeItem("xrAgent.metrics.name"),localStorage.removeItem("xrAgent.metrics.version"),localStorage.removeItem("xrAgent.metrics.settings.consent"),!0)},t.consented=function(){return!!t.consented()&&"false"!==localStorage.getItem("xrAgent.metrics.settings.consent")},t.sendPageView=function(t,e,n,r){return this.send({t:"pageview",path:t,hostname:e,title:n,params:r})},t.sendEvent=function(t,e,n,r){var i={t:"event",ec:t,ea:e};return null!==n&&(i.el=n),null!==r&&(i.ev=r),this.send(i)},t.sendTiming=function(t,e,n){return this.send({t:"timing",utc:t,utv:e,utt:n})},t.sendException=function(t){var e={t:"exception",exd:t,exf:!1===window.isSecureContext||"http:"===window.location.protocol&&window.location.port?"0":"1"};return this.send(e)},t.sendCommand=function(t){var e,n;return null===this.commandCount&&(this.commandCount={}),null===(e=this.commandCount)[t]&&(e[t]=0),this.commandCount[t]++,n={t:"event",ec:"command",ea:t.split(":")[0],el:t,ev:this.commandCount[t]},this.send(n)},t.send=function(e){if(t.consented()&&(this.tagId=e.tagId||this.tagId||localStorage.getItem("xrAgent.metrics.tagId"),this.clientId=this.clientId||localStorage.getItem("xrAgent.metrics.clientId"),this.dp=e.dp||e.uri||this.uri,this.p=e.p||this.p||this.dp,this.dh=e.host||e.dh||this.host,this.dt=e.title||e.dt||this.title,this.dr=e.referrer||e.dr||this.dr,this.uip=e.remoteAddr||e.uip||this.uip,this.xrAgentName=this.xrAgentName||localStorage.getItem("xrAgent.metrics.name"),this.xrAgentVersion=this.xrAgentVersion||localStorage.getItem("xrAgent.metrics.version"),navigator.onLine))return e=Object.assign({},e,{v:1,aip:1,tid:this.tagId,cid:this.clientId,dp:this.uri,dh:this.dh,dt:this.dt,dr:this.dr,p:this.p,uip:this.remoteAddr,an:this.xrAgentName,av:this.xrAgentVersion,aiid:""}),e=Object.assign({},e,t.consentedParams()),t.isTelemetryConsentChoice(e)?t.request("https://ssl.google-analytics.com/collect?"+n.stringify(e)):void 0},t.isTelemetryConsentChoice=function(t){return"event"===t.t&&"setting"===t.ec&&"xrAgent.metrics.settings.consent"===t.ea},t.request=function(t){return function(t,e){if(void 0===e&&(e=null),"sendBeacon"in navigator)return navigator.sendBeacon(t,e);var n=new XMLHttpRequest;return n.open("POST",t),n.send(e)}(t)},t.consentedParams=function(){return{sr:window.screen.width+"x"+window.screen.height,vp:window.innerWidth+"x"+window.innerHeight,dpr:window.devicePixelRatio||1,capvr:!!navigator.getVRDisplays,capxr:!!navigator.xr,capgp:!!window.Gamepad,capaudio:!!window.AudioContext||!!window.webkitAudioContext,capwasm:!!window.WebAssembly,capric:!!window.requestIdleCallback,capwebgl:function(){try{var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return e&&e instanceof WebGLRenderingContext||!1}catch(t){return!1}}(),capwebgl2:function(){try{var t=document.createElement("canvas").getContext("webgl2");return t&&t instanceof WebGL2RenderingContext||!1}catch(t){return!1}}(),capworker:!!window.Worker,capsw:!!navigator.serviceWorker,caphc:navigator.hardwareConcurrency||0,capws:!!window.WebSocket||!1,capwebrtc:!!window.RTCPeerConnection&&!!window.RTCDataChannelEvent||!1,capendian:function(){if(!window.ArrayBuffer)return"Unknown";var t=new ArrayBuffer(4),e=new Uint32Array(t),n=new Uint8Array(t);return e[0]=1,1===n[0]?"little":"big"}(),ua:navigator.userAgent}},t}(),o=/'?((\/|\\|[a-z]:\\)[^\s']+)+'?/gi,s=function(){};s.constructor=function(t,e){this.tagId=t,this.clientId=e},s.activate=function(t){if(!i.consented())return!1;this.subscriptions=[];var e,n=t.sessionLength;return this.ensureClientId((e=this,function(){return e.begin(n)}))},s.prototype.deactivate=function(){delete this.subscriptions,this.subscriptions=[]},s.prototype.serialize=function(){return{sessionLength:Date.now()-this.sessionStart}},s.prototype.provideReporter=function(){return{sendEvent:i.sendEvent.bind(i),sendTiming:i.sendTiming.bind(i),sendException:i.sendException.bind(i)}},s.prototype.begin=function(t){this.sessionStart=Date.now(),t&&i.sendEvent("window","ended",null,t),i.sendEvent("window","started"),this.watchExceptions(),this.watchPageView(),this.watchEvents(),this.watchPerfTimings()},s.prototype.ensureClientId=function(t){return localStorage.getItem("xrAgent.metrics.clientId")?t():this.createClientId(function(e){return localStorage.setItem("xrAgent.metrics.clientId",e),t()})},s.prototype.createClientId=function(t){return t(this.clientId?this.clientId:void 0)},s.prototype.getClientId=function(){return localStorage.getItem("xrAgent.metrics.clientId")},s.prototype.getTagId=function(){return this.tagId?this.tagId:(this.tagId=localStorage.getItem("xrAgent.metrics.tagId"),this.tagId)},s.prototype.setTagId=function(t){return this.tagId=localStorage.setItem("xrAgent.metrics.tagId",t),t},s.prototype.watchExceptions=function(){return this.subscriptions.push(function(){window.addEventListener("error",function(t){var e,n=t;return"string"!=typeof t&&(n=t.message),n=(e=n,e.replace(o,"<path>")||"Unknown").replace("Uncaught ","").slice(0,150),i.sendException(n)})})},s.prototype.watchPageView=function(){return this.subscriptions.push(function(){i.sendPageView(location.pathname,location.href,document.title)})},s.prototype.watchEvents=function(){return this.subscriptions.push(function(){})},s.prototype.watchTimings=function(){return this.subscriptions.push(function(){})};var c=new s(function(t){if(document.currentScript)return document.currentScript.getAttribute("data-tag");if(!(t=t||document.scriptURL||document.currentScript&&document.currentScript.src))return null;try{return new window.URLSearchParams(new window.URL(t).search).get("tag")}catch(e){return(t.match(/[?&]tag=(.+)/i)||[])[1]}}());c.activate(),module.exports=c;
//# sourceMappingURL=metrics.js.map
