var t=function(t,e){void 0===t&&(t=window),void 0===e&&(e="");try{this.storage=t.localStorage}catch(t){this.storage={}}this.prefix=e||""};t.prototype.get=function(t){try{return this.storage[this.prefix+t]}catch(t){return null}},t.prototype.set=function(t,e){try{return this.storage[this.prefix+t]=e,e}catch(t){return null}},t.prototype.delete=function(t){try{delete this.storage[this.prefix+t]}catch(t){return null}},t.prototype.clear=function(t){try{delete this.storage}catch(t){return null}};var i=function(e,n,i,r){if(void 0===e&&(e=""),void 0===i&&(i=window),void 0===r&&(r=document),!e)throw new Error("`tagId` argument required for `Reporter` (e.g., `XXXXXX-YY`)");this.tagId=e,this.win=i||window,this.doc=r||document,this.storage=n||new t(this.win,"xrAgent.metrics."),this.consented=this.hasConsented()};i.prototype.setTagId=function(t){void 0===t&&(t=null),this.tagId=t},i.prototype.saveConsent=function(t){return void 0===t&&(t=!0),!this.hasConsented()&&(this.storage.set("settings.consent",t?"true":"false"),!0)},i.prototype.removeConsent=function(t){return void 0===t&&(t=!0),!!this.hasConsented()&&(this.storage.remove("clientId"),this.storage.remove("name"),this.storage.remove("version"),this.storage.remove("settings.consent"),!0)},i.prototype.hasConsented=function(){return!0===this.consented||"false"!==this.storage.get("settings.consent")},i.prototype.sendPageView=function(t,e,n,i){return this.send({t:"pageview",path:t,hostname:e,title:n,params:i})},i.prototype.sendEvent=function(t,e,n,i){var r={t:"event",ec:t,ea:e};return null!==n&&(r.el=n),null!==i&&(r.ev=i),this.send(r)},i.prototype.sendTiming=function(t,e,n){return this.send({t:"timing",utc:t,utv:e,utt:n})},i.prototype.sendException=function(t){var e,n={t:"exception",exd:t,exf:(e=this.win,!1===e.isSecureContext||"http:"===e.location.protocol&&e.location.port?"0":"1")};return this.send(n)},i.prototype.sendCommand=function(t){var e,n;return null===this.commandCount&&(this.commandCount={}),null===(e=this.commandCount)[t]&&(e[t]=0),this.commandCount[t]++,n={t:"event",ec:"command",ea:t.split(":")[0],el:t,ev:this.commandCount[t]},this.send(n)},i.prototype.send=function(t){if(this.hasConsented()&&(this.tagId=t.tagId||this.tagId||this.storage.get("tagId"),this.clientId=this.clientId||this.storage.get("clientId"),this.dp=t.dp||t.uri||this.uri,this.p=t.p||this.p||this.dp,this.dh=t.host||t.dh||this.host,this.dt=t.title||t.dt||this.title,this.dr=t.referrer||t.dr||this.dr,this.uip=t.remoteAddr||t.uip||this.uip,this.xrAgentName=this.xrAgentName||this.storage.get("name"),this.xrAgentVersion=this.xrAgentVersion||this.storage.get("version"),navigator.onLine))return t=Object.assign({},t,{v:1,aip:1,tid:this.tagId,cid:this.clientId,dp:this.uri,dh:this.dh,dt:this.dt,dr:this.dr,p:this.p,uip:this.remoteAddr,an:this.xrAgentName,av:this.xrAgentVersion,aiid:""}),t=Object.assign({},t,this.consentedParams()),this.isTelemetryConsentChoice(t)?this.request("https://ssl.google-analytics.com/collect?"+e.stringify(t)):void 0},i.prototype.isTelemetryConsentChoice=function(t){return"event"===t.t&&"setting"===t.ec&&"settings.consent"===t.ea},i.prototype.request=function(t){return function(t,e){if(void 0===e&&(e=null),"sendBeacon"in navigator)return navigator.sendBeacon(t,e);var n=new XMLHttpRequest;return n.open("POST",t),n.send(e)}(t)},i.prototype.consentedParams=function(){return{sr:this.win.screen.width+"x"+this.win.screen.height,vp:this.win.innerWidth+"x"+this.win.innerHeight,dpr:(t=this.win,t.devicePixelRatio||1),capvr:!!this.win.navigator.getVRDisplays,capxr:!!this.win.navigator.xr,capgp:!!this.win.Gamepad,capaudio:!!this.win.AudioContext||!!this.win.webkitAudioContext,capwasm:!!this.win.WebAssembly,capric:!!this.win.requestIdleCallback,capwebgl:function(t,e){try{var n=e.createElement("canvas"),i=n.getContext("webgl")||n.getContext("experimental-webgl");return i&&i instanceof t.WebGLRenderingContext||!1}catch(t){return!1}}(this.win),capwebgl2:function(t,e){try{var n=e.createElement("canvas").getContext("webgl2");return n&&n instanceof t.WebGL2RenderingContext||!1}catch(t){return!1}}(this.win),capworker:!!this.win.Worker,capsw:!!this.win.navigator.serviceWorker,caphc:this.win.navigator.hardwareConcurrency||0,capws:!!this.win.WebSocket||!1,capwebrtc:!!this.win.RTCPeerConnection&&!!this.win.RTCDataChannelEvent||!1,capendian:function(t){if(!t.ArrayBuffer)return"Unknown";var e=new t.ArrayBuffer(4),n=new t.Uint32Array(e),i=new t.Uint8Array(e);return n[0]=1,1===i[0]?"little":"big"}(this.win),ua:function(t){return t.navigator.userAgent}(this.win)};var t};var r=/'?((\/|\\|[a-z]:\\)[^\s']+)+'?/gi;function s(){var t,e,n="";for(ix=0;t<32;t++)e=16*Math.random()|0,8!==t&&12!==t&&16!==t&&20!==t||(n+="-"),n+=(12==t?4:16==t?3&e|8:e).toString(16);return n}var o=function(e,n,r,s,o,a){void 0===o&&(o=window),void 0===a&&(a=document),this.tagId=e,this.clientId=n,this.win=o||window,this.doc=a||document,this.storage=r||new t(this.win,"xrAgent.metrics."),this.reporter=s||new i(this.tagId,this.storage,this.win,this.doc)};o.prototype.activate=function(t){if(void 0===t&&(t={}),!this.reporter.hasConsented())return!1;this.subscriptions=[];var e,n=t.sessionLength||Date.now();return this.ensureClientId((e=this,function(){return e.begin(n)}))},o.prototype.deactivate=function(){delete this.subscriptions,this.subscriptions=[]},o.prototype.serialize=function(){return{sessionLength:Date.now()-this.sessionStart}},o.prototype.provideReporter=function(){return{sendEvent:this.reporter.sendEvent.bind(this.reporter),sendTiming:this.reporter.sendTiming.bind(this.reporter),sendException:this.reporter.sendException.bind(this.reporter)}},o.prototype.begin=function(t){this.sessionStart=Date.now(),t&&this.reporter.sendEvent("window","ended",null,t),this.reporter.sendEvent("window","started"),this.watchExceptions(),this.watchPageView()},o.prototype.ensureClientId=function(t){var e=this;return e.storage.get("clientId")?t():e.createClientId(function(n){return e.storage.set("clientId",n),t()})},o.prototype.createClientId=function(t){return t(this.clientId?this.clientId:s)},o.prototype.getClientId=function(){return this.storage.get("clientId")},o.prototype.getTagId=function(){return this.tagId?this.tagId:(this.tagId=this.storage.get("tagId"),this.tagId)},o.prototype.setTagId=function(t){return this.tagId=this.storage.set("tagId",t),t},o.prototype.watchExceptions=function(){return this.subscriptions.push(function(){window.addEventListener("error",function(t){var e,n=t;return"string"!=typeof t&&(n=t.message),n=(e=n,e.replace(r,"<path>")||"Unknown").replace("Uncaught ","").slice(0,150),self.reporter.sendException(n)})})},o.prototype.watchPageView=function(){var t=this;return t.subscriptions.push(function(){t.reporter.sendPageView(t.win.location.pathname,t.win.location.href,t.doc.title)})};var a=function(t,e,n){if(e=e||window,n=n||document,!(t=t||n.scriptURL||n.currentScript&&n.currentScript.src)&&n.currentScript&&(t=n.currentScript.getAttribute("data-tag")),!t)return null;try{return new e.URLSearchParams(new e.URL(t).search).get("tag")}catch(e){return(t.match(/[?&]tag=(.+)/i)||[])[1]}}(null,window,document),c=new o(a,null,null,new i(a,null,window,document),window,document);c.activate(),module.exports=c;
//# sourceMappingURL=metrics.js.map
