!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.webxrMetrics=e()}(this,function(){var t=function(t,e){void 0===t&&(t=window),void 0===e&&(e="");try{this.storage=t.localStorage}catch(t){this.storage={}}this.prefix=e||""};t.prototype.get=function(t){try{return this.storage[this.prefix+t]}catch(t){return null}},t.prototype.set=function(t,e){try{return this.storage[this.prefix+t]=e,e}catch(t){return null}},t.prototype.remove=function(t){var e=this;if(Array.isArray(t))return t.map(function(t){return e.remove(t)});try{delete this.storage[this.prefix+t]}catch(t){return null}},t.prototype.delete=function(t){return this.remove(t)},t.prototype.clear=function(t){try{delete this.storage}catch(t){return null}this.storage={}};var e=function(t,e,n){void 0===t&&(t=window),void 0===e&&(e=document),void 0===n&&(n=navigator),this.win=t,this.doc=e,this.nav=n||this.win.navigator||navigator||{}},n={browserFeatures:{configurable:!0},browserSettings:{configurable:!0},hardwareFeatures:{configurable:!0}};n.browserFeatures.get=function(){if(this._browserFeatures)return this._browserFeatures;this._browserFeatures=new i(this.win,this.doc,this.nav)},n.browserSettings.get=function(){if(this._browserSettings)return this._browserSettings;this._browserSettings=new o(this.win,this.doc,this.nav)},n.hardwareFeatures.get=function(){if(this._hardwareFeatures)return this._hardwareFeatures;this._hardwareFeatures=new a(this.win,this.doc,this.nav)},Object.defineProperties(e.prototype,n);var i=function(t,e,n){void 0===t&&(t=window),void 0===e&&(e=document),void 0===n&&(n=navigator),this.win=t,this.doc=e,this.nav=n||this.win.navigator||navigator||{}},r={userAgent:{configurable:!0},gamepads:{configurable:!0},webaudio:{configurable:!0},wasm:{configurable:!0},requestIdleCallback:{configurable:!0},webgl:{configurable:!0},webgl2:{configurable:!0},webrtc:{configurable:!0},websocket:{configurable:!0},webworker:{configurable:!0},serviceworker:{configurable:!0},webvr:{configurable:!0},webxr:{configurable:!0}};r.userAgent.get=function(){return this.nav.userAgent},r.gamepads.get=function(){return!!this.nav.getGamepads},r.webaudio.get=function(){return!!this.win.AudioContext||!!this.win.webkitAudioContext},r.wasm.get=function(){return!!this.win.WebAssembly},r.requestIdleCallback.get=function(){return!!this.win.requestIdleCallback},r.webgl.get=function(){try{var t=this.doc.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(e&&e instanceof this.win.WebGLRenderingContext)return!0}catch(t){}return!1},r.webgl2.get=function(){try{var t=this.doc.createElement("canvas").getContext("webgl2");if(t&&t instanceof this.win.WebGL2RenderingContext)return!0}catch(t){}return!1},r.webrtc.get=function(){return!!this.win.RTCPeerConnection&&!!this.win.RTCDataChannelEvent},r.websocket.get=function(){return!!this.win.WebSocket},r.webworker.get=function(){return!!this.win.Worker},r.serviceworker.get=function(){return!!this.nav.serviceWorker},r.webvr.get=function(){return!!this.nav.getVRDisplays},r.webxr.get=function(){return!!this.nav.xr},Object.defineProperties(i.prototype,r);var o=function(t,e,n){void 0===t&&(t=window),void 0===e&&(e=document),void 0===n&&(n=navigator),this.win=t,this.doc=e,this.nav=n||this.win.navigator||navigator||{}},s={cookieEnabled:{configurable:!0},doNotTrackEnabled:{configurable:!0}};s.cookieEnabled.get=function(){return!!this.nav.cookieEnabled||!1},s.doNotTrackEnabled.get=function(){var t=this.nav.doNotTrack||!1;return!t&&"unspecified"!==t},Object.defineProperties(o.prototype,s);var a=function(t,e,n){void 0===t&&(t=window),void 0===e&&(e=document),void 0===n&&(n=navigator),this.win=t,this.doc=e,this.nav=n||this.win.navigator||navigator||{}},c={devicePixelRatio:{configurable:!0},endianness:{configurable:!0},screenResolution:{configurable:!0},workerPoolSize:{configurable:!0},windowSize:{configurable:!0}};c.devicePixelRatio.get=function(){return this.win.devicePixelRatio||1},c.endianness.get=function(){if(!this.win.ArrayBuffer)return"Unknown";var t=new this.win.ArrayBuffer(4),e=new this.win.Uint32Array(t),n=new this.win.Uint8Array(t);return e[0]=1,1===n[0]?"little":"big"},c.screenResolution.get=function(){return this.win.screen.width+"x"+this.win.screen.height},c.workerPoolSize.get=function(){return this.nav.hardwareConcurrency||0},c.windowSize.get=function(){return this.win.innerWidth+"x"+this.win.innerHeight},Object.defineProperties(a.prototype,c);var u={};function h(t,e){return e.encode?e.strict?encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):encodeURIComponent(t):t}u.stringify=function(t,e){if(!t)return"";!1===(e=Object.assign({},t,{encode:!0,strict:!0})).sort&&(e.sort=function(){});return Object.keys(t).sort(e.sort).map(function(n){var i=t[n];if(void 0===i)return"";if(null===i)return h(n,e);if(Array.isArray(i)){var r=[];return i.slice().forEach(function(t){void 0!==t&&r.push(function(t,n){return null===n?h(t,e):[h(t,e),"=",h(n,e)].join("")}(n,t))}),r.join("&")}return h(n,e)+"="+h(i,e)}).filter(function(t){return t.length>0}).join("&")};var d={querystring:u,postBeacon:function(t,e,n){if(void 0===e&&(e=null),"sendBeacon"in(n=n||win.navigator))return n.sendBeacon(t,e);var i=new XMLHttpRequest;return i.open("POST",t),i.send(e)}},g={protocolVersion:"1",dataSource:"web"},p={trackingId:"",baseTelemetryCollectionUrl:"https://ssl.google-analytics.com/collect?"},l=function(e,n,i,r,o){if(void 0===i&&(i=window),void 0===r&&(r=document),void 0===o&&(o=navigator),this.opts="string"==typeof e?{trackingId:e}:Object.assign({},this.opts,p),this.trackingId=this.opts.trackingId,!this.trackingId)throw new Error("`trackingId` argument required for `Reporter` (e.g., `UA-XXXXXXXXX-Y`)");this.baseTelemetryCollectionUrl=this.opts.baseTelemetryCollectionUrl,this.win=i||window,this.doc=r||document,this.nav=o||this.win.navigator||navigator||{},this.storage=n||new t(this.win,"xrAgent.metrics."),this.consented=this.hasConsented()};l.prototype.setTrackingId=function(t){void 0===t&&(t=null),this.trackingId=t},l.prototype.saveConsent=function(t){return void 0===t&&(t=!0),!this.hasConsented()&&(this.storage.set("settings.consent",t?"true":"false"),!0)},l.prototype.removeConsent=function(t){return void 0===t&&(t=!0),!!this.hasConsented()&&(this.storage.remove(["clientId","name","version","settings.consent"]),!0)},l.prototype.hasConsented=function(){return!0===this.consented||"false"!==this.storage.get("settings.consent")},l.prototype.sendPageView=function(t,e,n,i){return this.send({t:"pageview",path:t,hostname:e,title:n,params:i})},l.prototype.sendEvent=function(t,e,n,i){var r={t:"event",ec:t,ea:e};return null!==n&&(r.el=n),null!==i&&(r.ev=i),this.send(r)},l.prototype.sendTiming=function(t,e,n){return this.send({t:"timing",utc:t,utv:e,utt:n})},l.prototype.sendException=function(t){var e,n={t:"exception",exd:t,exf:(e=this.win,!1===e.isSecureContext||"http:"===e.location.protocol&&e.location.port?"0":"1")};return this.send(n)},l.prototype.sendCommand=function(t){null===this.commandCount&&(this.commandCount={});var e=this.commandCount;null===e[t]&&(e[t]=0),this.commandCount[t]++;var n={t:"event",ec:"command",ea:t.split(":")[0],el:t,ev:this.commandCount[t]};return this.send(n)},l.prototype.send=function(t){if(this.hasConsented()&&(this.trackingId=t.trackingId||this.trackingId||this.storage.get("trackingId"),this.clientId=this.clientId||this.storage.get("clientId"),this.documentPath=t.documentPath||t.uri||this.uri,this.p=t.p||this.p||this.documentPath,this.dh=t.host||t.dh||this.host,this.dt=t.title||t.dt||this.title,this.dr=t.referrer||t.dr||this.dr,this.uip=t.remoteAddr||t.uip||this.uip,this.xrAgentName=this.xrAgentName||this.storage.get("name"),this.xrAgentVersion=this.xrAgentVersion||this.storage.get("version"),navigator.onLine))return t=Object.assign({},t,{v:g.protocolVersion,aip:1,tid:this.trackingId,ds:g.dataSource,cid:this.clientId,dp:this.uri,dh:this.dh,dt:this.dt,dr:this.dr,p:this.p,uip:this.remoteAddr,an:this.xrAgentName,av:this.xrAgentVersion}),t=Object.assign({},t,this.consentedParams()),this.isTelemetryConsentChoice(t)?this.request(""+this.baseTelemetryCollectionUrl+d.querystring.stringify(t)):void 0},l.prototype.isTelemetryConsentChoice=function(t){return"event"===t.t&&"setting"===t.ec&&"settings.consent"===t.ea},l.prototype.request=function(t){return console.log("request",t),d.postBeacon(t)},l.prototype.consentedParams=function(){var t=new e(this.win,this.doc,this.nav),n=t.hardwareFeatures,i=t.browserFeatures;return console.log(t,n),{sr:n.screenResolution,vp:n.windowSize,dpr:n.devicePixelRatio,capvr:i.webvr,capxr:i.webxr,capgp:i.gamepads,capaudio:i.webaudio,capwasm:i.wasm,capric:i.requestIdleCallback,capwebgl:i.webgl,capwebgl2:i.webgl2,capworker:i.worker,capsw:i.serviceworker,caphc:n.workerPoolSize,capws:i.websocket,capwebrtc:i.webrtc,capendian:n.endianness,ua:i.userAgent}};var w=/'?((\/|\\|[a-z]:\\)[^\s']+)+'?/gi;function f(){var t,e,n="";for(t=0;t<32;t++)e=16*Math.random()|0,8!==t&&12!==t&&16!==t&&20!==t||(n+="-"),n+=(12===t?4:16===t?3&e|8:e).toString(16);return n}var v=function(e,n,i,r,o,s){void 0===o&&(o=window),void 0===s&&(s=document),this.clientId=n,this.win=o||window,this.doc=s||document,this.storage=i||new t(this.win,"xrAgent.metrics."),this.reporter=r||new l(this.trackingId,this.storage,this.win,this.doc),this.trackingId=e||r.trackingId};v.prototype.activate=function(t){if(void 0===t&&(t={}),!this.reporter.hasConsented())return!1;this.subscriptions=[];var e,n=t.sessionLength||Date.now();return this.ensureClientId((e=this,function(){return e.begin(n)}))},v.prototype.deactivate=function(){delete this.subscriptions,this.subscriptions=[]},v.prototype.serialize=function(){return{sessionLength:Date.now()-this.sessionStart}},v.prototype.provideReporter=function(){return{sendEvent:this.reporter.sendEvent.bind(this.reporter),sendTiming:this.reporter.sendTiming.bind(this.reporter),sendException:this.reporter.sendException.bind(this.reporter)}},v.prototype.begin=function(t){this.sessionStart=Date.now(),t&&this.reporter.sendEvent("window","ended",null,t),this.reporter.sendEvent("window","started"),this.watchExceptions(),this.watchPageView()},v.prototype.ensureClientId=function(t){var e=this;return this.storage.get("clientId")?t():this.createClientId(function(n){return e.storage.set("clientId",n),t()})},v.prototype.createClientId=function(t){return t(this.clientId?this.clientId:f)},v.prototype.getClientId=function(){return this.storage.get("clientId")},v.prototype.getTid=function(){return this.trackingId?this.trackingId:(this.trackingId=this.storage.get("tid"),this.trackingId)},v.prototype.setTid=function(t){return this.trackingId=this.storage.set("tid",t),t},v.prototype.watchExceptions=function(){var t=this;return this.subscriptions.push(function(){window.addEventListener("error",function(e){var n,i=e;return"string"!=typeof e&&(i=e.message),i=(n=i,n.replace(w,"<path>")||"Unknown").replace("Uncaught ","").slice(0,150),t.reporter.sendException(i)})})},v.prototype.watchPageView=function(){var t=this;return this.subscriptions.push(function(){t.reporter.sendPageView(self.win.location.pathname,self.win.location.href,self.doc.title)})};var b=function(t,e,n){if(e=e||window,n=n||document,!(t=t||n.scriptURL||n.currentScript&&n.currentScript.src)&&n.currentScript){var i=n.currentScript.getAttribute("data-tid")||n.currentScript.getAttribute("data-id")||"";if(i.trim().startsWith("UA-"))return i}if(!t)return null;try{var r=new e.URLSearchParams(new e.URL(t).search);return r.get("tid")||r.get("id")}catch(e){return(t.match(/[?&]tid=(.+)/i)||[])[1]||(t.match(/[?&]id=(.+)/i)||[])[1]}}(),m=new v(null,null,null,new l(b));return m.activate(),m});
//# sourceMappingURL=metrics.umd.js.map
