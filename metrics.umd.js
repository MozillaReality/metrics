!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.webxrMetrics=e()}(this,function(){var t={};function e(t,e){return e.encode?e.strict?encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()}):encodeURIComponent(t):t}t.stringify=function(t,n){if(!t)return"";!1===(n=Object.assign({},t,{encode:!0,strict:!0})).sort&&(n.sort=function(){});return Object.keys(t).sort(n.sort).map(function(r){var i=t[r];if(void 0===i)return"";if(null===i)return e(r,n);if(Array.isArray(i)){var o=[];return i.slice().forEach(function(t){void 0!==t&&o.push(function(t,r){return null===r?e(t,n):[e(t,n),"=",e(r,n)].join("")}(r,t))}),o.join("&")}return e(r,n)+"="+e(i,n)}).filter(function(t){return t.length>0}).join("&")};var n=function(){var e=function(t){if(void 0===t&&(t=""),!t)throw new Error("`tagId` argument required for `Reporter` (e.g., `XXXXXX-YY`)");this.tagId=t,this.consented=!0;try{this.consented="false"!==localStorage.getItem("xrAgent.metrics.settings.consent")}catch(t){}};return e.prototype.setTagId=function(t){void 0===t&&(t=null),this.tagId=t},e.prototype.saveConsent=function(t){if(void 0===t&&(t=!0),this.consented)return!1;try{localStorage.setItem("xrAgent.metrics.settings.consent",t?"true":"false")}catch(t){}return!0},e.prototype.removeConsent=function(t){return void 0===t&&(t=!0),!!this.consented&&(localStorage.removeItem("xrAgent.metrics.clientId"),localStorage.removeItem("xrAgent.metrics.name"),localStorage.removeItem("xrAgent.metrics.version"),localStorage.removeItem("xrAgent.metrics.settings.consent"),!0)},e.prototype.consented=function(){return!!this.consented&&"false"!==localStorage.getItem("xrAgent.metrics.settings.consent")},e.prototype.sendPageView=function(t,e,n,r){return this.send({t:"pageview",path:t,hostname:e,title:n,params:r})},e.prototype.sendEvent=function(t,e,n,r){var i={t:"event",ec:t,ea:e};return null!==n&&(i.el=n),null!==r&&(i.ev=r),this.send(i)},e.prototype.sendTiming=function(t,e,n){return this.send({t:"timing",utc:t,utv:e,utt:n})},e.prototype.sendException=function(t){var e={t:"exception",exd:t,exf:!1===window.isSecureContext||"http:"===window.location.protocol&&window.location.port?"0":"1"};return this.send(e)},e.prototype.sendCommand=function(t){var e,n;return null===this.commandCount&&(this.commandCount={}),null===(e=this.commandCount)[t]&&(e[t]=0),this.commandCount[t]++,n={t:"event",ec:"command",ea:t.split(":")[0],el:t,ev:this.commandCount[t]},this.send(n)},e.prototype.send=function(e){if(this.consented()&&(this.tagId=e.tagId||this.tagId||localStorage.getItem("xrAgent.metrics.tagId"),this.clientId=this.clientId||localStorage.getItem("xrAgent.metrics.clientId"),this.dp=e.dp||e.uri||this.uri,this.p=e.p||this.p||this.dp,this.dh=e.host||e.dh||this.host,this.dt=e.title||e.dt||this.title,this.dr=e.referrer||e.dr||this.dr,this.uip=e.remoteAddr||e.uip||this.uip,this.xrAgentName=this.xrAgentName||localStorage.getItem("xrAgent.metrics.name"),this.xrAgentVersion=this.xrAgentVersion||localStorage.getItem("xrAgent.metrics.version"),navigator.onLine))return e=Object.assign({},e,{v:1,aip:1,tid:this.tagId,cid:this.clientId,dp:this.uri,dh:this.dh,dt:this.dt,dr:this.dr,p:this.p,uip:this.remoteAddr,an:this.xrAgentName,av:this.xrAgentVersion,aiid:""}),e=Object.assign({},e,this.consentedParams()),this.isTelemetryConsentChoice(e)?this.request("https://ssl.google-analytics.com/collect?"+t.stringify(e)):void 0},e.prototype.isTelemetryConsentChoice=function(t){return"event"===t.t&&"setting"===t.ec&&"xrAgent.metrics.settings.consent"===t.ea},e.prototype.request=function(t){return function(t,e){if(void 0===e&&(e=null),"sendBeacon"in navigator)return navigator.sendBeacon(t,e);var n=new XMLHttpRequest;return n.open("POST",t),n.send(e)}(t)},e.prototype.consentedParams=function(){return{sr:window.screen.width+"x"+window.screen.height,vp:window.innerWidth+"x"+window.innerHeight,dpr:window.devicePixelRatio||1,capvr:!!navigator.getVRDisplays,capxr:!!navigator.xr,capgp:!!window.Gamepad,capaudio:!!window.AudioContext||!!window.webkitAudioContext,capwasm:!!window.WebAssembly,capric:!!window.requestIdleCallback,capwebgl:function(){try{var t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");return e&&e instanceof WebGLRenderingContext||!1}catch(t){return!1}}(),capwebgl2:function(){try{var t=document.createElement("canvas").getContext("webgl2");return t&&t instanceof WebGL2RenderingContext||!1}catch(t){return!1}}(),capworker:!!window.Worker,capsw:!!navigator.serviceWorker,caphc:navigator.hardwareConcurrency||0,capws:!!window.WebSocket||!1,capwebrtc:!!window.RTCPeerConnection&&!!window.RTCDataChannelEvent||!1,capendian:function(){if(!window.ArrayBuffer)return"Unknown";var t=new ArrayBuffer(4),e=new Uint32Array(t),n=new Uint8Array(t);return e[0]=1,1===n[0]?"little":"big"}(),ua:navigator.userAgent}},e}(),r=/'?((\/|\\|[a-z]:\\)[^\s']+)+'?/gi;function i(){var t,e,n="";for(ix=0;t<32;t++)e=16*Math.random()|0,8!==t&&12!==t&&16!==t&&20!==t||(n+="-"),n+=(12==t?4:16==t?3&e|8:e).toString(16);return n}var o=function(t,e){void 0===t&&(t=window),void 0===e&&(e="");try{this.storage=t.localStorage}catch(t){this.storage={}}this.prefix=e||""};o.prototype.get=function(t){try{return this.storage[this.prefix+t]}catch(t){return null}},o.prototype.set=function(t,e){try{return this.storage[this.prefix+t]=e,e}catch(t){return null}},o.prototype.delete=function(t){try{delete this.storage[this.prefix+t]}catch(t){return null}},o.prototype.clear=function(t){try{delete this.storage}catch(t){return null}};var s=function(t,e,n,r,i){void 0===r&&(r=window),void 0===i&&(i=document),this.tagId=t,this.clientId=e,this.storage=n||new o(r,"xrAgent.metrics.")};s.prototype.activate=function(t){if(!this.consented())return!1;this.subscriptions=[];var e,n=t.sessionLength;return this.ensureClientId((e=this,function(){return e.begin(n)}))},s.prototype.deactivate=function(){delete this.subscriptions,this.subscriptions=[]},s.prototype.serialize=function(){return{sessionLength:Date.now()-this.sessionStart}},s.prototype.provideReporter=function(){return{sendEvent:n.sendEvent.bind(n),sendTiming:n.sendTiming.bind(n),sendException:n.sendException.bind(n)}},s.prototype.begin=function(t){this.sessionStart=Date.now(),t&&n.sendEvent("window","ended",null,t),n.sendEvent("window","started"),this.watchExceptions(),this.watchPageView()},s.prototype.ensureClientId=function(t){var e=this;return e.storage.get("clientId")?t():this.createClientId(function(n){return e.storage.set("clientId",n),t()})},s.prototype.createClientId=function(t){return t(this.clientId?this.clientId:i)},s.prototype.getClientId=function(){return this.storage.get("clientId")},s.prototype.getTagId=function(){return this.tagId?this.tagId:(this.tagId=this.storage.get("tagId"),this.tagId)},s.prototype.setTagId=function(t){return this.tagId=this.storage.set("tagId",t),t},s.prototype.watchExceptions=function(){return this.subscriptions.push(function(){window.addEventListener("error",function(t){var e,i=t;return"string"!=typeof t&&(i=t.message),i=(e=i,e.replace(r,"<path>")||"Unknown").replace("Uncaught ","").slice(0,150),n.sendException(i)})})},s.prototype.watchPageView=function(){var t=this;return t.subscriptions.push(function(){n.sendPageView(t.win.location.pathname,t.win.location.href,t.doc.title)})};var c=new s(function(t,e,n){if(e=e||window,n=n||document,!(t=t||n.scriptURL||n.currentScript&&n.currentScript.src)&&n.currentScript&&(t=n.currentScript.getAttribute("data-tag")),!t)return null;try{return new e.URLSearchParams(new e.URL(t).search).get("tag")}catch(e){return alert(t),(t.match(/[?&]tag=(.+)/i)||[])[1]}}(null,window,document),null,window,document);return c.activate(),c});
//# sourceMappingURL=metrics.umd.js.map
