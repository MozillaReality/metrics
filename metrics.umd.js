!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("path")):"function"==typeof define&&define.amd?define(["path"],t):t(e.path)}(this,function(e){e=e&&e.hasOwnProperty("default")?e.default:e;var t={};function n(e,t){return t.encode?t.strict?encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}):encodeURIComponent(e):e}t.stringify=function(e,t){if(!e)return"";!1===(t=Object.assign({},e,{encode:!0,strict:!0})).sort&&(t.sort=function(){});return Object.keys(e).sort(t.sort).map(function(i){var a=e[i];if(void 0===a)return"";if(null===a)return n(i,t);if(Array.isArray(a)){var r=[];return a.slice().forEach(function(e){void 0!==e&&r.push(function(e,i){return null===i?n(e,t):[n(e,t),"=",n(i,t)].join("")}(i,e))}),r.join("&")}return n(i,t)+"="+n(a,t)}).filter(function(e){return e.length>0}).join("&")};var i=function(){var e,t,n,i,a,r;for(r=arguments[0],e=0,n=(a=2<=arguments.length?Array.prototype.slice.call(arguments,1):[]).length;e<n;e++)for(t in i=a[e])r[t]=i[t];return r},a=function(){function n(){}return n.consented=function(){return"limited"===atom.config.get("core.telemetryConsent")},n.sendEvent=function(e,t,n,i){var a={t:"event",ec:e,ea:t};return null!==n&&(a.el=n),null!==i&&(a.ev=i),this.send(a)},n.sendTiming=function(e,t,n){return this.send({t:"timing",utc:e,utv:t,utt:n})},n.sendException=function(e){var t={t:"exception",exd:e,exf:atom.inDevMode()?"0":"1"};return this.send(t)},n.viewNameForPaneItem=function(t){var n;"function"==typeof t.getViewClass&&(n=t.getViewClass().name);var i,a=null===n?t.constructor.name:n;if("function"==typeof t.getPath&&(i=t.getPath()),null===i||e.dirname(i)!==atom.getConfigDirPath())return a;var r=e.extname(i);switch(e.basename(i,r)){case"config":".json"!==r&&".cson"!==r||(a="UserConfig");break;case"init":".js"!==r&&".coffee"!==r||(a="UserInitScript");break;case"keymap":".json"!==r&&".cson"!==r||(a="UserKeymap");break;case"snippets":".json"!==r&&".cson"!==r||(a="UserSnippets");break;case"styles":".css"!==r&&".less"!==r||(a="UserStylesheet")}return a},n.sendPaneItem=function(e){var t,n={t:"appview",cd:this.viewNameForPaneItem(e)},i="function"==typeof e.getGrammar&&null!==(t=e.getGrammar())?t.name:void 0;return null!==i&&(n.dt=i),this.send(n)},n.sendCommand=function(e){var t,n;return null===this.commandCount&&(this.commandCount={}),null===(t=this.commandCount)[e]&&(t[e]=0),this.commandCount[e]++,n={t:"event",ec:"command",ea:e.split(":")[0],el:e,ev:this.commandCount[e]},this.send(n)},n.send=function(e){if(navigator.onLine&&(i(e,{v:1,aip:1,tid:"UA-3769691-33",cid:localStorage.getItem("metrics.userId"),an:"atom",av:atom.getVersion()}),n.consented()))return i(e,n.consentedParams()),n.isTelemetryConsentChoice(e)?n.request("https://ssl.google-analytics.com/collect?"+t.stringify(e)):void 0},n.isTelemetryConsentChoice=function(e){return"event"===e.t&&"setting"===e.ec&&"core.telemetryConsent"===e.ea},n.request=function(e){return function(e){var t;return(t=new XMLHttpRequest).open("POST",e),t.send(null)}(e)},n.consentedParams=function(){return{sr:screen.width+"x"+screen.height,vp:innerWidth+"x"+innerHeight,aiid:(e=atom.getVersion(),e.indexOf("beta")>-1?"beta":e.indexOf("dev")>-1?"dev":"stable")};var e},n}(),r=(require("atom"),{"vim-mode:move-up":!0,"vim-mode:move-down":!0,"vim-mode:move-left":!0,"vim-mode:move-right":!0}),s=/'?((\/|\\|[a-z]:\\)[^\s']+)+'?/gi;module.exports={activate:function(e){var t,n;return t=e.sessionLength,this.subscriptions=[],this.shouldIncludePanesAndCommands=Math.random()<.05,this.ensureClientId((n=this,function(){return n.begin(t)}))},deactivate:function(){var e;return null!==(e=this.subscriptions)?e.dispose():void 0},serialize:function(){return{sessionLength:Date.now()-this.sessionStart}},provideReporter:function(){return{sendEvent:a.sendEvent.bind(a),sendTiming:a.sendTiming.bind(a),sendException:a.sendException.bind(a)}},begin:function(e){return this.sessionStart=Date.now(),e&&a.sendEvent("window","ended",null,e),a.sendEvent("window","started"),this.subscriptions.push(atom.onDidThrowError(function(e){var t;return t=e,"string"!=typeof e&&(t=e.message),t=(t=t.replace(s,"<path>")||"Unknown").replace("Uncaught ","").slice(0,150),a.sendException(t)})),this.subscriptions.push(atom.textEditors.observe(function(e){var t;if(t=e.getGrammar())return a.sendEvent("file","open",t.scopeName)})),this.subscriptions.push(atom.config.onDidChange("core.telemetryConsent",function(e){var t=e.newValue;if("undecided"!==t)return a.sendEvent("setting","core.telemetryConsent",t)})),this.watchPaneItems(),this.watchCommands(),this.watchDeprecations(),null!==atom.getLoadSettings().shellLoadTime&&a.sendTiming("shell","load",atom.getLoadSettings().shellLoadTime),process.nextTick(function(){return a.sendTiming("core","load",atom.getWindowLoadTime())})},ensureClientId:function(e){return localStorage.getItem("metrics.userId")?e():atom.config.get("metrics.userId")?(localStorage.setItem("metrics.userId",atom.config.get("metrics.userId")),e()):this.createClientId(function(t){return localStorage.setItem("metrics.userId",t),e()})},createClientId:function(e){return e(require("node-uuid").v4())},getClientId:function(){return localStorage.getItem("metrics.userId")},watchPaneItems:function(){return this.subscriptions.push(atom.workspace.onDidAddPaneItem((e=this,function(t){var n;if(n=t.item,e.shouldIncludePanesAndCommands)return a.sendPaneItem(n)})));var e},watchCommands:function(){return this.subscriptions.push(atom.commands.onWillDispatch((e=this,function(t){var n,i;if(e.shouldIncludePanesAndCommands&&(n=t.type,!(null!==(i=t.detail)&&i.jQueryTrigger||n.startsWith("core:")||n.startsWith("editor:")||-1===n.indexOf(":")||n in r)))return a.sendCommand(n)})));var e},reportDeprecation:function(e){var t,n,i,r,s,o,c,u,d,m;for(t in n=e.getMessage().slice(0,500),o=e.stacks)(s=null!==(c=null!==(u=(m=o[t]).metadata)?u.packageName:void 0)?c:(this.getPackageName(m)||"").toLowerCase())&&(this.packageVersionCache[s]||(r=atom.packages.getLoadedPackage(s),this.packageVersionCache[s]=(null!==r&&null!==(d=r.metadata)?d.version:void 0)||"unknown"),null===this.deprecationCache[(i=s+"@"+this.packageVersionCache[s])+n]&&(this.deprecationCache[i+n]=!0,a.sendEvent("deprecation-v3",i,n)))},getFileNameFromCallSite:function(e){var t=e.fileName;return null===t?e.getFileName():t},getPackageName:function(t){var n,i,a,r,s,o,c;for(s=this.getPackagePathsByPackageName(),i=a=1,o=t.length;1<=o?a<o:a>o;i=1<=o?++a:--a){if(!(n=this.getFileNameFromCallSite(t[i])))return;if(!n.includes(e.sep+"node_modules"+e.sep)){for(r in s)if(c=e.relative(s[r],n),!/^\.\./.test(c))return r;if(atom.getUserInitScriptPath()===n)return"init-script"}}},getPackagePathsByPackageName:function(){var t,n,i,a;if(null!==this.packagePathsByPackageName)return this.packagePathsByPackageName;for(this.packagePathsByPackageName={},t=0,n=(a=atom.packages.getLoadedPackages()).length;t<n;t++)this.packagePathsByPackageName[(i=a[t]).name]=i.path,(i.path.indexOf(".atom/dev/packages")>-1||i.path.indexOf(".atom/packages")>-1)&&(this.packagePathsByPackageName[i.name]=e.resolve(i.path));return this.packagePathsByPackageName}}});
//# sourceMappingURL=metrics.umd.js.map
